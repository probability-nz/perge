!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("peerjs"),require("automerge")):"function"==typeof define&&define.amd?define(["peerjs","automerge"],t):(e=e||self).perge=t(e.peerjs,e.automerge)}(this,function(e,t){return e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,function(){function n(n,o){var r=this;void 0===o&&(o={}),this._connections={},this._actorId=n,this.peer=o.peer||new e(this._actorId),this.docSet=o.docSet||new t.DocSet,this._encode=o.encode||JSON.stringify,this._decode=o.decode||JSON.parse,this.peer.on("connection",function(e){r._connections[e.peer]||r.connect(e.peer,e)})}var o=n.prototype;return o.connect=function(e,n,o){var r=this;if(this._connections[e])return this.peer.connections[e];var c=n||this.peer.connect(e,o),i=this._connections[e]=new t.Connection(this.docSet,function(e){c.send(r._encode(e))}),s=function(e){return i.receiveMsg(r._decode(e))},u=function(){c.off("data",s),r._connections[e]&&(delete r._connections[e],i.close())};return c.on("data",s),c.on("close",u),c.on("error",u),i.open(),c},o.get=function(e){return this.docSet.getDoc(e)||t.init(this._actorId)},o.select=function(e){var t=this;return function(n){var o=n.apply(void 0,[t.get(e)].concat([].slice.call(arguments,1)));return t.docSet.setDoc(e,o),o}},o.subscribe=function(e,t){var n=this;if("function"==typeof e)return this.docSet.registerHandler(e),function(){return n.docSet.unregisterHandler(e)};if("string"==typeof e&&t){var o=function(n,o){n===e&&t(o)};return this.docSet.registerHandler(o),function(){return n.docSet.unregisterHandler(o)}}return function(){}},n}()});
//# sourceMappingURL=index.umd.js.map
